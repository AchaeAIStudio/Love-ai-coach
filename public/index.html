<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI ê´€ê³„ ì½”ì¹˜</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7f9fc;
      color: #333;
    }
    .container {
      width: 100%;
      max-width: 480px;
      margin: auto;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      font-weight: 700;
    }
    .card {
      background: white;
      padding: 18px;
      margin-top: 20px;
      border-radius: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .btn {
      width: 100%;
      margin-top: 20px;
      padding: 15px;
      border: none;
      background: #2F6BFF;
      color: white;
      border-radius: 12px;
      font-size: 17px;
      cursor: pointer;
    }
    .btn:hover {
      background: #1f4ed6;
    }
    textarea {
      width: 100%;
      height: 140px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin-top: 10px;
      font-size: 15px;
      resize: none;
    }
    .mbti-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 15px;
    }
    .mbti-btn {
      padding: 12px;
      text-align: center;
      background: #f1f1f1;
      border-radius: 10px;
      cursor: pointer;
      border: 1px solid #ddd;
    }
    .mbti-btn.active {
      background: #2F6BFF;
      color: white;
      border-color: #2F6BFF;
    }
    .result-card {
      background: white;
      padding: 20px;
      border-radius: 14px;
      margin-top: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>

<body>
  <div class="container">

    <h1>AI ê´€ê³„ ì½”ì¹˜</h1>
    <p style="text-align:center;">ë‹¹ì‹ ì˜ ì„±í–¥ê³¼ ëŒ€í™” ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ<br>ìƒëŒ€ì˜ ë§ˆìŒê³¼ ì „ëµì„ ë¶„ì„í•©ë‹ˆë‹¤.</p>

    <!-- 1ë‹¨ê³„: ë³¸ì¸ MBTI -->
    <div class="card">
      <h2>ë‹¹ì‹ ì˜ MBTI</h2>
      <div class="mbti-grid" id="myMBTI"></div>
    </div>

    <!-- 2ë‹¨ê³„: ë³¸ì¸ ì„±í–¥ ì§ˆë¬¸ (4ê°œ ì˜ˆì‹œ. ë‚˜ì¤‘ì— ëŠ˜ë¦´ ìˆ˜ ìˆê²Œ êµ¬ì¡° ì™„ì„±) -->
    <div class="card">
      <h2>ë‹¹ì‹ ì˜ ì„±í–¥</h2>
      <div id="traits"></div>
    </div>

    <!-- 3ë‹¨ê³„: ìƒëŒ€ MBTI ì„ íƒ -->
    <div class="card">
      <h2>ìƒëŒ€ì˜ MBTI</h2>
      <div class="mbti-grid" id="targetMBTI"></div>
    </div>

    <!-- 4ë‹¨ê³„: ì¹´í†¡ ëŒ€í™” -->
    <div class="card">
      <h2>ì¹´í†¡ ëŒ€í™”</h2>
      <textarea id="chatText" placeholder="ìƒëŒ€ì™€ ëŒ€í™” ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
    </div>

    <!-- 5ë‹¨ê³„: ë‚´ê°€ í•˜ê³  ì‹¶ì€ ë§ -->
    <div class="card">
      <h2>ë‚´ê°€ í•˜ê³  ì‹¶ì€ ë§</h2>
      <textarea id="myIntent" placeholder="ë‚˜ì˜ ì†ë§ˆìŒ í˜¹ì€ í•˜ê³  ì‹¶ì€ ë§ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
    </div>

    <button class="btn" onclick="analyze()">AI ë¶„ì„ ì‹œì‘</button>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <div id="resultArea"></div>

  </div>

  <script>
    const MBTIS = [
      "INTJ","INTP","INFJ","INFP",
      "ENTJ","ENTP","ENFJ","ENFP",
      "ISTJ","ISTP","ISFJ","ISFP",
      "ESTJ","ESTP","ESFJ","ESFP"
    ];

    // --- MBTI ë²„íŠ¼ ì„¸íŒ… ---
    function renderMBTI(containerId, stateKey) {
      const box = document.getElementById(containerId);
      MBTIS.forEach(type => {
        const el = document.createElement("div");
        el.className = "mbti-btn";
        el.innerText = type;
        el.onclick = () => {
          document.querySelectorAll(`#${containerId} .mbti-btn`).forEach(btn => btn.classList.remove("active"));
          el.classList.add("active");
          window[stateKey] = type;
        };
        box.appendChild(el);
      });
    }

    renderMBTI("myMBTI", "my_mbti");
    renderMBTI("targetMBTI", "target_mbti");

    // --- ì„±í–¥ ì§ˆë¬¸ ---
    const traitQuestions = [
      "ë‚˜ëŠ” ë‚¯ì„  ì‚¬ëŒì—ê²Œ ì‰½ê²Œ ë§ˆìŒì„ ì—¬ëŠ” í¸ì´ë‹¤.",
      "ë‚˜ëŠ” ìƒëŒ€ì˜ ê°ì • ë³€í™”ì— ë¯¼ê°í•˜ë‹¤.",
      "ë‚˜ëŠ” ê°ˆë“±ì´ ìƒê²¨ë„ ë¨¼ì € í•´ê²°í•˜ë ¤ê³  í•œë‹¤.",
      "ë‚˜ëŠ” í˜¼ìë§Œì˜ ì‹œê°„ì´ ê¼­ í•„ìš”í•˜ë‹¤."
    ];

    const traitsBox = document.getElementById("traits");
    traitQuestions.forEach((q, i) => {
      const div = document.createElement("div");
      div.style.marginBottom = "15px";
      div.innerHTML = `
        <p>${i+1}. ${q}</p>
        <div>
          ${[1,2,3,4,5].map(n =>
            `<label style="margin-right:8px;">
              <input type="radio" name="trait${i}" value="${n}" ${n===3?"checked":""}> ${n}
            </label>`).join("")}
        </div>
      `;
      traitsBox.appendChild(div);
    });

    // --------------------
    // ğŸ”¥ AI ë¶„ì„ í•¨ìˆ˜
    // --------------------
    async function analyze() {
      if (!my_mbti || !target_mbti) {
        alert("MBTIë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }

      const chat = document.getElementById("chatText").value.trim();
      const intent = document.getElementById("myIntent").value.trim();
      
      const traits = traitQuestions.map((q, i) => {
        const v = document.querySelector(`input[name=trait${i}]:checked`).value;
        return { question: q, score: v };
      });

      const payload = {
        my_mbti,
        target_mbti,
        chat,
        intent,
        traits
      };

      const resBox = document.getElementById("resultArea");
      resBox.innerHTML = "<p>â³ AI ë¶„ì„ ì¤‘...</p>";

      try {
        const response = await fetch("/analyze", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(payload)
        });

        const data = await response.json();

        resBox.innerHTML = `
          <div class="result-card">
            <h3>ğŸ“Œ ìƒëŒ€ì˜ ì˜ë„</h3>
            <p>${data.target_intent}</p>
          </div>

          <div class="result-card">
            <h3>ğŸ“Œ ë‹¹ì‹ ì—ê²Œ í•„ìš”í•œ ì „ëµ</h3>
            <p>${data.strategy}</p>
          </div>

          <div class="result-card">
            <h3>ğŸ“Œ ì¶”ì²œ ë©˜íŠ¸ 5ê°€ì§€</h3>
            <p>${data.recommend.join("<br><br>")}</p>
          </div>
        `;
      } catch (e) {
        resBox.innerHTML = "<p>âŒ AI ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>";
      }
    }
  </script>
</body>
</html>
